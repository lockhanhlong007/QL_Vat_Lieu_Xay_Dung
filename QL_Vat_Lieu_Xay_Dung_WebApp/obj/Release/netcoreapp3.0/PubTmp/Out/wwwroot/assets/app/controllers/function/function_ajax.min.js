var function_ajax=function(){function r(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"vi",rules:{txtId:{required:!0},txtURL:{required:!0},txtName:{required:!0},txtOrder:{number:!0}}});$("#btnCreate").off("click").on("click",function(){i();t();$("#modal-add-edit").modal("show")});$("body").on("click","#btnEdit",function(n){$("#txtId").prop("readonly",!0);n.preventDefault();$.ajax({type:"GET",url:"/Admin/Function/GetById",data:{id:$("#txtId").val()},dataType:"json",beforeSend:function(){app.startLoading()},success:function(n){var i=n;$("#txtId").val(i.Id);$("#txtName").val(i.Name);$("#txtURL").val(i.URL);t(i.ParentId);$("#txtIconCss").val(i.IconCss);$("#ckStatus").prop("checked",i.Status===1);$("#txtOrder").val(i.SortOrder);$("#modal-add-edit").modal("show");app.stopLoading()},error:function(){app.notify("Có lỗi xảy ra","error");app.stopLoading()}})});$("body").on("click","#btnDelete",function(t){t.preventDefault();var i=$("#txtId").val();app.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Function/Delete",data:{id:i},dataType:"json",beforeSend:function(){app.startLoading()},success:function(){app.notify("Xóa thành công","success");app.stopLoading();n()},error:function(){app.notify("Có lỗi trong quá trình xóa","error");app.stopLoading()}})})});$("#btnSave").on("click",function(t){if($("#frmMaintainance").valid()){t.preventDefault();var r=$("#txtId").val(),u=$("#txtName").val(),f=$("#txtURL").val(),e=$("#ddlCategoryId").combotree("getValue"),o=$("#txtIconCss").val(),s=parseInt($("#txtOrder").val()),h=$("#ckStatus").prop("checked")===!0?1:0;$.ajax({type:"POST",url:"/Admin/Function/SaveEntity",data:{Id:r,Name:u,URL:f,ParentId:e,IconCss:o,SortOrder:s,Status:h},dataType:"json",beforeSend:function(){app.startLoading()},success:function(){app.notify("Cập nhật thành công","success");$("#modal-add-edit").modal("hide");i();app.stopLoading();n(!0)},error:function(){app.notify("Có lỗi trong quá trình cập nhật","error");app.stopLoading()}})}return!1})}function i(){$("#txtId").prop("readonly",!1);$("#txtId").val("");$("#txtName").val("");$("#txtURL").val("");t("");$("#txtIconCss").val("");$("#ckStatus").prop("checked",!0);$("#txtOrder").val("")}function t(n){$.ajax({url:"/Admin/Function/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var i=[],r;$.each(t,function(n,t){i.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});r=app.unflattern(i);$("#ddlCategoryId").combotree({data:r});n!=undefined&&$("#ddlCategoryId").combotree("setValue",n)}})}function n(){$.ajax({url:"/Admin/Function/GetAll",dataType:"json",success:function(t){var r=[],i;$.each(t,function(n,t){r.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});i=app.unflattern(r);i.sort(function(n,t){return n.sortOrder-t.sortOrder});$("#treeFunction").tree({data:i,dnd:!0,onContextMenu:function(n,t){n.preventDefault();$("#txtId").val(t.id);$("#contextMenu").menu("show",{left:n.pageX,top:n.pageY})},onDrop:function(t,i,r){var u=$(this).tree("getNode",t),f;r==="append"?(f=[],$.each(u.children,function(n,t){f.push({key:t.id,value:n})}),$.ajax({type:"POST",url:"/Admin/Function/UpdateParentId",data:{sourceId:i.id,targetId:u.id,items:f},dataType:"json",success:function(){n()}})):(r==="top"||r==="bottom")&&$.ajax({type:"POST",url:"/Admin/Function/ReOrder",data:{sourceId:i.id,targetId:u.id},dataType:"json",success:function(){n()}})}})},error:function(n){console.log(n);app.notify("Không thể tải danh mục funtion","error")}})}this.initialize=function(){n();r()}};