var productCategoryController=function(){function r(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"vi",rules:{txtNameM:{required:!0},txtOrderM:{number:!0},txtHomeOrderM:{number:!0}}});$("#btnCreate").off("click").on("click",function(){i();t();$("#modal-add-edit").modal("show")});$("body").on("click","#btnEdit",function(n){n.preventDefault();var i=$("#hidId").val();$.ajax({type:"GET",url:"/Admin/ProductCategory/GetById",data:{id:i},dataType:"json",beforeSend:function(){app.startLoading()},success:function(n){var i=n;$("#hidId").val(i.Id);$("#txtName").val(i.Name);t(i.ParentId);$("#txtImage").val(i.Image);$("#txtSeoKeyword").val(i.SeoKeywords);$("#txtSeoDescription").val(i.SeoDescription);$("#txtSeoPageTitle").val(i.SeoPageTitle);$("#txtSeoAlias").val(i.SeoAlias);$("#ckStatus").prop("checked",i.Status===1);$("#ckShowHome").prop("checked",i.HomeFlag);$("#txtOrder").val(i.SortOrder);$("#txtHomeOrder").val(i.HomeOrder);$("#modal-add-edit").modal("show");app.stopLoading()},error:function(){app.notify("Có lỗi xảy ra","error");app.stopLoading()}})});$("body").on("click","#btnDelete",function(t){t.preventDefault();var i=$("#hidIdM").val();app.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/ProductCategory/Delete",data:{id:i},dataType:"json",beforeSend:function(){app.startLoading()},success:function(){app.notify("Xóa thành công","success");app.stopLoading();n()},error:function(){app.notify("Có lỗi trong quá trình xóa","error");app.stopLoading()}})})});$("#btnSave").on("click",function(t){if($("#frmMaintainance").valid()){t.preventDefault();var r=parseInt($("#hidId").val()),u=$("#txtName").val(),f=$("#ddlCategoryId").combotree("getValue"),e=$("#txtDesc").val(),o=$("#txtImage").val(),s=parseInt($("#txtOrder").val()),h=$("#txtHomeOrder").val(),c=$("#txtSeoKeyword").val(),l=$("#txtSeoDescription").val(),a=$("#txtSeoPageTitle").val(),v=$("#txtSeoAlias").val(),y=$("#ckStatus").prop("checked")==!0?1:0,p=$("#ckShowHome").prop("checked");$.ajax({type:"POST",url:"/Admin/ProductCategory/SaveEntity",data:{Id:r,Name:u,Description:e,ParentId:f,HomeOrder:h,SortOrder:s,HomeFlag:p,Image:o,Status:y,SeoPageTitle:a,SeoAlias:v,SeoKeywords:c,SeoDescription:l},dataType:"json",beforeSend:function(){app.startLoading()},success:function(){app.notify("Cập nhật thành công","success");$("#modal-add-edit").modal("hide");i();app.stopLoading();n(!0)},error:function(){app.notify("Có lỗi trong quá trình cập nhật","error");app.stopLoading()}})}return!1});$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()});$("#fileInputImage").on("change",function(){for(var r=$(this).get(0),t=r.files,i=new FormData,n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/UploadImageFile/UploadImage",contentType:!1,processData:!1,data:i,success:function(n){$("#txtImage").val(n);app.notify("Tải ảnh lên thành công","success")},error:function(){app.notify("Có lỗi trong quá trình tải ảnh!","error")}})})}function i(){$("#hidId").val(0);$("#txtName").val("");t("");$("#txtDesc").val("");$("#txtOrder").val("");$("#txtHomeOrder").val("");$("#txtImage").val("");$("#txtMetakeyword").val("");$("#txtMetaDescription").val("");$("#txtSeoPageTitle").val("");$("#txtSeoAlias").val("");$("#ckStatus").prop("checked",!0);$("#ckShowHome").prop("checked",!1)}function t(n){$.ajax({url:"/Admin/ProductCategory/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var i=[],r;$.each(t,function(n,t){i.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});r=app.unflattern(i);$("#ddlCategoryIdM").combotree({data:r});n!=undefined&&$("#ddlCategoryIdM").combotree("setValue",n)}})}function n(){$.ajax({url:"/Admin/ProductCategory/GetAll",dataType:"json",success:function(t){var r=[],i;$.each(t,function(n,t){r.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});i=app.unflattern(r);i.sort(function(n,t){return n.sortOrder-t.sortOrder});$("#treeProductCategory").tree({data:i,dnd:!0,onContextMenu:function(n,t){n.preventDefault();$("#hidIdM").val(t.id);$("#contextMenu").menu("show",{left:n.pageX,top:n.pageY})},onDrop:function(t,i,r){var u=$(this).tree("getNode",t),f;r==="append"?(f=[],$.each(u.children,function(n,t){f.push({key:t.id,value:n})}),$.ajax({type:"POST",url:"/Admin/ProductCategory/UpdateParentId",data:{sourceId:i.id,targetId:u.id,items:f},dataType:"json",success:function(){n()}})):(r==="top"||r==="bottom")&&$.ajax({type:"POST",url:"/Admin/ProductCategory/ReOrder",data:{sourceId:i.id,targetId:u.id},dataType:"json",success:function(){n()}})}})},error:function(n){console.log(n);app.notify("Không thể tải danh mục","error")}})}this.initialize=function(){n();r()}};