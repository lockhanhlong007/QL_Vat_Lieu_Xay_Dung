var user_ajax = function () { function u() { $("#frmMaintainance").validate({ errorClass: "red", ignore: [], lang: "vi", rules: { txtFullName: { required: !0 }, txtUserName: { required: !0 }, txtPassword: { required: !0, minlength: 6 }, txtConfirmPassword: { equalTo: "#txtPassword" }, txtEmail: { required: !0, email: !0 } } }); $("#txt-search-keyword").keypress(function (t) { t.which === 13 && (t.preventDefault(), n()) }); $("#btn-search").on("click", function () { n() }); $("#ddl-show-page").on("change", function () { app.configs.pageSize = $(this).val(); app.configs.pageIndex = 1; n(!0) }); $("#btn-create").on("click", function () { r(); t(); $("#modal-add-edit").modal("show") }); $("body").on("click", ".btn-edit", function (n) { n.preventDefault(); var r = $(this).data("id"); $.ajax({ type: "GET", url: "/Admin/User/GetById", data: { id: r }, dataType: "json", beforeSend: function () { app.startLoading() }, success: function (n) { var r = n; $("#hidId").val(r.Id); $("#txtFullName").val(r.FullName); $("#txtUserName").val(r.UserName); $("#txtEmail").val(r.Email); $("#txtPhoneNumber").val(r.PhoneNumber); $("#ckStatus").prop("checked", r.Status === 1); $("#txtImage").val(r.Avatar); t(r.Roles); i(!0); $("#modal-add-edit").modal("show"); app.stopLoading() }, error: function () { app.notify("Có lỗi xảy ra", "error"); app.stopLoading() } }) }); $("#btnSave").on("click", function (t) { var u; if ($("#frmMaintainance").valid()) { t.preventDefault(); var f = $("#hidId").val(), e = $("#txtFullName").val(), o = $("#txtUserName").val(), s = $("#txtPassword").val(), h = $("#txtEmail").val(), c = $("#txtPhoneNumber").val(), l = $("#txtImage").val(), i = []; $.each($('input[name="ckRoles"]'), function (n, t) { $(t).prop("checked") === !0 && i.push($(t).prop("value")) }); u = $("#ckStatus").prop("checked") === !0 ? 1 : 0; $.ajax({ type: "POST", url: "/Admin/User/SaveEntity", data: { Id: f, FullName: e, UserName: o, PasswordHash: s, Email: h, Avatar: l, PhoneNumber: c, Status: u, Roles: i }, dataType: "json", beforeSend: function () { app.startLoading() }, success: function () { app.notify("Cập nhật thành công", "success"); $("#modal-add-edit").modal("hide"); r(); app.stopLoading(); n(!0) }, error: function () { app.notify("Có lỗi trong quá trình cập nhật", "error"); app.stopLoading() } }) } return !1 }); $("body").on("click", ".btn-delete", function (t) { t.preventDefault(); var i = $(this).data("id"); app.confirm("Bạn Có Chắc Muốn Xóa Chứ?", function () { $.ajax({ type: "POST", url: "/Admin/User/Delete", data: { id: i }, beforeSend: function () { app.startLoading() }, success: function () { app.notify("Xóa Thành Công", "success"); app.stopLoading(); n(!0) }, error: function () { app.notify("Có Lỗi Trong Quá Trình Xóa", "error"); app.stopLoading() } }) }) }); $("#btnSelectImg").on("click", function () { $("#fileInputImage").click() }); $("#fileInputImage").on("change", function () { for (var r = $(this).get(0), t = r.files, i = new FormData, n = 0; n < t.length; n++)i.append(t[n].name, t[n]); $.ajax({ type: "POST", url: "/Admin/UploadImageFile/UploadImage", contentType: !1, processData: !1, data: i, success: function (n) { $("#txtImage").val(n); app.notify("Tải ảnh lên thành công", "success") }, error: function () { app.notify("Có lỗi trong quá trình tải ảnh!", "error") } }) }) } function i(n) { $("#txtUserName").prop("disabled", n); $("#txtPassword").prop("disabled", n); $("#txtConfirmPassword").prop("disabled", n) } function r() { i(!1); $("#hidId").val(""); $("#txtImage").val(""); t(); $("#txtFullName").val(""); $("#txtUserName").val(""); $("#txtPassword").val(""); $("#txtConfirmPassword").val(""); $('input[name="ckRoles"]').removeAttr("checked"); $("#txtEmail").val(""); $("#txtPhoneNumber").val(""); $("#ckStatus").prop("checked", !0) } function t(n) { $.ajax({ url: "/Admin/Role/GetAll", type: "GET", dataType: "json", async: !0, success: function (t) { var r = $("#role-template").html(), u = t, i = ""; $.each(u, function (t, u) { var f = ""; n !== undefined && n.indexOf(u.Name) !== -1 && (f = "checked"); i += Mustache.render(r, { Name: u.Name, Description: u.Description, Checked: f }) }); $("#list-roles").html(i) } }) } function n(t) { $.ajax({ type: "GET", url: "/Admin/User/GetAllPaging", data: { keyword: $("#txt-search-keyword").val(), page: app.configs.pageIndex, pageSize: app.configs.pageSize }, dataType: "json", beforeSend: function () { app.startLoading() }, success: function (i) { var u = $("#table-template").html(), r = ""; i.RowCount > 0 ? ($.each(i.ResultList, function (n, t) { r += Mustache.render(u, { FullName: t.FullName, Id: t.Id, UserName: t.UserName, Avatar: t.Avatar !== null ? '<img src="' + t.Avatar + '" width=25 />' : '<img src="/img_ds/img.jpg" width=25', DateCreated: app.dateTimeFormatJson(t.DateCreated), Status: app.getStatus(t.Status) }) }), $("#lbl-total-records").text(i.RowCount), r !== undefined && $("#tbl-content").html(r), f(i.RowCount, function () { n() }, t)) : $("#tbl-content").html(""); app.stopLoading() }, error: function (n) { console.log(n) } }) } function f(n, t, i) { var r = Math.ceil(n / app.configs.pageSize); ($("#paginationUL a").length === 0 || i === !0) && ($("#paginationUL").empty(), $("#paginationUL").removeData("twbs-pagination"), $("#paginationUL").unbind("page")); $("#paginationUL").twbsPagination({ totalPages: r, visiblePages: 7, first: "Đầu", prev: "Trước", next: "Tiếp", last: "Cuối", onPageClick: function (n, i) { app.configs.pageIndex = i; setTimeout(t(), 200) } }) } this.initialize = function () { n(); u() } };