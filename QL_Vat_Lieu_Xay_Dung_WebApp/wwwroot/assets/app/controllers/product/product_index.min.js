var product_ajax=function(){function e(){CKEDITOR.replace("txtContent",{});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}}function o(){$("#frmMaintainance").validate({errorClass:"red",ignore:[],lang:"vi",rules:{txtName:{required:!0},ddlCategoryId:{required:!0},txtPrice:{number:!0,min:5e3}}});$("#ddlShowPage").on("change",function(){app.configs.pageSize=$(this).val();app.configs.pageIndex=1;n(!0)});$("#btnSearch").click(function(t){t.preventDefault();n()});$("#txtKeyword").keypress(function(t){t.which===13&&(t.preventDefault(),n())});$("#btnCreate").on("click",function(){i();$("#modal-add-edit").modal("show")});$("body").on("click",".btn-edit",function(n){n.preventDefault();var i=$(this).data("id");$.ajax({type:"GET",url:"/Admin/Product/GetById",data:{id:i},dataType:"json",beforeSend:function(){app.startLoading()},success:function(n){var i=n;$("#hidId").val(i.Id);$("#txtName").val(i.Name);t(i.CategoryId);r(i.BrandId);$("#txtDesc").val(i.Description);$("#txtUnit").val(i.Unit);$("#txtPrice").val(i.Price);$("#txtOriginalPrice").val(i.OriginalPrice);$("#txtPromotionPrice").val(i.PromotionPrice);$("#txtImage").val(i.Image);$("#hidDateCreated").val(i.DateCreated);$("#txtTag").val(i.Tags);$("#txtMetaKeyWord").val(i.SeoKeywords);$("#txtMetaDescription").val(i.SeoDescription);$("#txtSeoPageTitle").val(i.SeoPageTitle);$("#txtSeoAlias").val(i.SeoAlias);u(!1);CKEDITOR.instances.txtContent.setData(i.Content);$("#ckStatus").prop("checked",i.Status===1);$("#ckHot").prop("checked",i.HotFlag);$("#ckShowHome").prop("checked",i.HomeFlag);$("#modal-add-edit").modal("show");app.stopLoading()},error:function(){app.notify("Có lỗi xảy ra","error");app.stopLoading()}})});$("body").on("click",".btn-delete",function(t){t.preventDefault();var i=$(this).data("id");app.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Product/Delete",data:{id:i},dataType:"json",beforeSend:function(){app.startLoading()},success:function(){app.notify("Xóa Thành Công","success");app.stopLoading();n(!0)},error:function(){app.notify("Có lỗi trong quá trình xóa","error");app.stopLoading()}})})});$("#btnSave").on("click",function(t){if($("#frmMaintainance").valid()){t.preventDefault();var r=$("#hidId").val(),u=$("#txtName").val(),f=$("#ddlCategoryId").combotree("getValue"),e=$("#txtDesc").val(),o=$("#txtUnit").val(),s=$("#txtPrice").val(),h=$("#txtOriginalPrice").val(),c=$("#txtPromotionPrice").val(),l=$("#hidDateCreated").val(),a=$("#txtImage").val(),v=$("#txtTag").val(),y=$("#txtMetaKeyWord").val(),p=$("#txtMetaDescription").val(),w=$("#txtSeoPageTitle").val(),b=$("#txtSeoAlias").val(),k=$("#ddlBrandId").val(),d=CKEDITOR.instances.txtContent.getData(),g=$("#ckStatus").prop("checked")===!0?1:0,nt=$("#ckHot").prop("checked"),tt=$("#ckShowHome").prop("checked");return $.ajax({type:"POST",url:"/Admin/Product/SaveEntity",data:{Id:r,Name:u,CategoryId:f,Image:a,Price:s,OriginalPrice:h,PromotionPrice:c,Description:e,Content:d,HomeFlag:tt,BrandId:k,HotFlag:nt,Tags:v,Unit:o,DateCreated:l,Status:g,SeoPageTitle:w,SeoAlias:b,SeoKeywords:y,SeoDescription:p},dataType:"json",beforeSend:function(){app.startLoading()},success:function(){app.notify("Cập nhật sản phẩm thành công","success");$("#modal-add-edit").modal("hide");i();app.stopLoading();n(!0)},error:function(){app.notify("Có lỗi trong quá trình lưu sản phẩm","error");app.stopLoading()}}),!1}return!1});$("#btnSelectImg").on("click",function(){$("#fileInputImage").click()});$("#fileInputImage").on("change",function(){for(var r=$(this).get(0),t=r.files,i=new FormData,n=0;n<t.length;n++)i.append(t[n].name,t[n]);$.ajax({type:"POST",url:"/Admin/UploadImageFile/UploadImage",contentType:!1,processData:!1,data:i,success:function(n){$("#txtImage").val(n);app.notify("Tải ảnh lên thành công","success")},error:function(){app.notify("Có lỗi trong quá trình tải ảnh!","error")}})})}function t(n){$.ajax({url:"/Admin/ProductCategory/GetAll",type:"GET",dataType:"json",async:!1,success:function(t){var i=[],r;$.each(t,function(n,t){i.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});r=app.unflattern(i);$("#ddlCategoryId").combotree({data:r});n!=undefined&&$("#ddlCategoryId").combotree("setValue",n)}})}function i(){$("#hidId").val(0);$("#txtName").val("");u(!0);t("");var n=new Date,i=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate();$("#hidDateCreated").val(i);$("#txtDesc").val("");$("#txtUnit").val("");r(null);$("#txtPrice").val("0");$("#txtPromotionPrice").val("");$("#txtImage").val("");$("#txtTag").val("");$("#txtMetaKeyWord").val("");$("#txtMetaDescription").val("");$("#txtSeoPageTitle").val("");$("#txtSeoAlias").val("");CKEDITOR.instances.txtContent.setData("");$("#ckStatus").prop("checked",!0);$("#ckHot").prop("checked",!1);$("#ckShowHome").prop("checked",!1)}function s(){$.ajax({type:"GET",url:"/Admin/ProductCategory/GetAll",dataType:"json",success:function(n){var t="<option value = ''>=== Select Category ===<\/option>";$.each(n,function(n,i){t+="<option value='"+i.Id+"'>"+i.Name+"<\/option>"});$("#ddlCategorySearch").html(t)},error:function(n){console.log(n);app.notify("Không thể tải danh mục","error")}})}function r(n){$.ajax({type:"GET",url:"/Admin/Brand/GetAll",dataType:"json",success:function(t){var i="<option value = ''>=== Select Brand ===<\/option>";$.each(t,function(n,t){i+="<option value='"+t.Id+"'>"+t.Name+"<\/option>"});$("#ddlBrandId").html(i);n!=undefined&&$("#ddlBrandId").val(n)},error:function(n){console.log(n);app.notify("Không thể tải danh mục thương hiệu","error")}})}function u(n){$("#txtPromotionPrice").prop("disabled",n);$("#txtPrice").prop("disabled",n)}function n(t){var r=$("#table-template").html(),i="";$.ajax({type:"GET",data:{categoryId:$("#ddlCategorySearch").val(),keyword:$("#txtKeyword").val(),page:app.configs.pageIndex,pageSize:app.configs.pageSize},url:"/Admin/Product/GetAllPaging",dataType:"json",success:function(u){$.each(u.ResultList,function(n,t){console.log("lay data"+t);i+=Mustache.render(r,{Id:t.Id,Name:t.Name,Image:t.Image==null?'<img src="img.jpg" width=25':'<img src="'+t.Image+'" width=25 />',CategoryName:t.ProductCategory.Name,Price:app.formatNumber(t.Price,0),CreatedDate:app.dateFormatJson(t.DateCreated),Status:app.getStatus(t.Status)})});$("#lblTotalRecords").text(u.RowCount);i!==""&&$("#tbl-content").html(i);h(u.RowCount,function(){n()},t)},error:function(n){console.log(n);app.notify("Không thể tải dữ liệu","error")}})}function h(n,t,i){var r=Math.ceil(n/app.configs.pageSize);($("#paginationUL a").length===0||i===!0)&&($("#paginationUL").empty(),$("#paginationUL").removeData("twbs-pagination"),$("#paginationUL").unbind("page"));$("#paginationUL").twbsPagination({totalPages:r,visiblePages:7,first:"Đầu",prev:"Trước",next:"Tiếp",last:"Cuối",onPageClick:function(n,i){app.configs.pageIndex=i;setTimeout(t(),200)}})}var f=new ImagesManagementAjax;this.initialize=function(){s();n();o();e();f.initialize()}};